<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8">
  <title>专注 25 分钟，治愈一整天 | ADHD 闭环系统</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <!-- 国内 CDN，100% 可用 -->
  <link href="https://cdn.bootcdn.net/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.bootcdn.net/ajax/libs/bootstrap-icons/1.10.5/font/bootstrap-icons.min.css" rel="stylesheet">
  <link rel="stylesheet" href="style.css">
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark bg-gradient">
  <div class="container-fluid">
    <span class="navbar-brand fw-bold">专注 25 分钟，治愈一整天</span>
  </div>
</nav>

<div class="container-fluid mt-4">
  <div class="row g-4">
    <!-- 任务 -->
    <div class="col-md-4">
      <div class="card shadow-sm">
        <div class="card-header d-flex justify-content-between align-items-center">
          <span>今日任务</span>
          <button class="btn btn-sm btn-primary" id="addTaskBtn" data-bs-toggle="modal" data-bs-target="#addTaskModal"><i class="bi bi-plus-lg"></i></button>
        </div>
        <ul id="taskList" class="list-group list-group-flush"></ul>
        <div class="card-footer text-center">
          <small class="text-muted">累计完成 <span id="doneCount">0</span> 个番茄</small>
        </div>
      </div>
    </div>

    <!-- 番茄钟 -->
    <div class="col-md-4">
      <div class="card shadow-sm">
        <div class="card-header text-center fw-bold">番茄钟</div>
        <div class="card-body text-center">
          <div class="timer" id="timer">25:00</div>
          <button class="btn btn-success btn-lg" id="startBtn"><i class="bi bi-play-fill"></i> 开始专注</button>
          <button class="btn btn-outline-secondary mt-2" id="resetBtn"><i class="bi bi-arrow-clockwise"></i> 重置</button>
        </div>
      </div>
      <div class="card mt-3">
        <div class="card-header fw-bold">专注时长</div>
        <div class="card-body"><canvas id="focusChart" height="150"></canvas></div>
      </div>
    </div>

    <!-- 留言墙 -->
    <div class="col-md-4">
      <div class="card shadow-sm">
        <div class="card-header fw-bold">匿名留言墙</div>
        <ul id="msgWall" class="list-group list-group-flush"></ul>
        <div class="card-body">
          <textarea id="msgText" class="form-control mb-2" rows="2" placeholder="留下你的鼓励或感受..."></textarea>
          <button class="btn btn-primary w-100" id="sendMsgBtn"><i class="bi bi-send"></i> 发送</button>
        </div>
      </div>
    </div>
  </div>
</div>

<!-- 专注锁定 -->
<div class="lock-overlay" id="lockOverlay">
  <h2><i class="bi bi-shield-lock"></i> 专注中...</h2>
  <p>请保持专注，不要打开干扰应用</p>
  <button class="btn btn-danger mt-3" id="giveUpBtn"><i class="bi bi-x-lg"></i> 放弃本次番茄</button>
</div>

<!-- 新增任务模态框 -->
<div class="modal fade" id="addTaskModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header"><h5 class="modal-title">新增任务</h5><button type="button" class="btn-close" data-bs-dismiss="modal"></button></div>
      <div class="modal-body">
        <input id="taskTitle" class="form-control mb-2" placeholder="任务标题">
        <input id="taskDur" type="number" class="form-control" placeholder="分钟" value="25" min="5" max="120">
      </div>
      <div class="modal-footer"><button class="btn btn-primary" id="addTaskConfirm">添加</button></div>
    </div>
  </div>
</div>

<script src="https://cdn.bootcdn.net/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
<script src="script.js"></script>
</body>
</html>
:root {
  --primary: #0d6efd;
  --secondary: #6c757d;
  --bg: #f5f7fa;
  --card-bg: #ffffff;
  --text: #212529;
}
body { background: var(--bg); color: var(--text); font-family: -apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans",sans-serif; }
.navbar { background: linear-gradient(135deg, #0d6efd, #0a58ca); }
.timer { font-size: 4rem; font-weight: 700; color: var(--primary); text-align: center; margin: 1rem 0; }
.card { border: none; border-radius: 0.75rem; box-shadow: 0 2px 8px rgba(0,0,0,.05); background: var(--card-bg); }
.lock-overlay { position: fixed; inset: 0; background: rgba(0,0,0,.8); color: #fff; display: none; justify-content: center; align-items: center; flex-direction: column; z-index: 1050; }
// 纯前端本地存储版本
const tasks = JSON.parse(localStorage.getItem('tasks') || '[]');
let doneCount = +localStorage.getItem('doneCount') || 0;

function loadTasks() {
  const list = document.getElementById('taskList');
  list.innerHTML = '';
  tasks.forEach((t, idx) => {
    const li = document.createElement('li');
    li.className = 'list-group-item d-flex justify-content-between';
    li.innerHTML = `
      <span>${t.title} (${t.duration}min)</span>
      <button class="btn btn-sm ${t.done?'btn-secondary':'btn-outline-success'}" onclick="toggleTask(${idx})">${t.done?'已完成':'开始'}</button>`;
    list.appendChild(li);
  });
  document.getElementById('doneCount').textContent = doneCount;
}
loadTasks();

function toggleTask(idx) {
  if (tasks[idx].done) return;
  tasks[idx].done = true;
  doneCount++;
  localStorage.setItem('tasks', JSON.stringify(tasks));
  localStorage.setItem('doneCount', doneCount);
  loadTasks();
}

let sec = 25 * 60, timer = null;
const timerEl = document.getElementById('timer');
function renderTimer() {
  const m = String(Math.floor(sec / 60)).padStart(2, '0');
  const s = String(sec % 60).padStart(2, '0');
  timerEl.textContent = `${m}:${s}`;
}
renderTimer();

document.getElementById('startBtn').onclick = () => {
  if (timer) return;
  document.getElementById('lockOverlay').style.display = 'flex';
  timer = setInterval(() => {
    sec--;
    renderTimer();
    if (sec <= 0) {
      clearInterval(timer); timer = null;
      document.getElementById('lockOverlay').style.display = 'none';
      alert('专注完成！');
    }
  }, 1000);
};
document.getElementById('resetBtn').onclick = () => {
  clearInterval(timer); timer = null;
  sec = 25 * 60;
  renderTimer();
  document.getElementById('lockOverlay').style.display = 'none';
};
document.getElementById('giveUpBtn').onclick = () => {
  clearInterval(timer); timer = null;
  sec = 25 * 60;
  renderTimer();
  document.getElementById('lockOverlay').style.display = 'none';
};

document.getElementById('addTaskConfirm').onclick = () => {
  const title = document.getElementById('taskTitle').value.trim();
  const dur = +document.getElementById('taskDur').value;
  if (!title) return alert('请输入任务');
  tasks.push({ title, duration: dur, done: false });
  localStorage.setItem('tasks', JSON.stringify(tasks));
  bootstrap.Modal.getInstance(document.getElementById('addTaskModal')).hide();
  document.getElementById('taskTitle').value = '';
  loadTasks();
};

document.getElementById('saveMoodBtn').onclick = () => {
  const text = document.getElementById('moodText').value.trim();
  if (!text) return;
  const li = document.createElement('li');
  li.className = 'list-group-item';
  li.textContent = text;
  document.getElementById('msgWall').appendChild(li);
  document.getElementById('moodText').value = '';
};

// 推荐静态写死
const recs = [
  {title: "成人 ADHD 的 5 个时间管理技巧", url: "#"},
  {title: "2 分钟正念冥想练习", url: "#"}
];
recs.forEach(r=>{
  const li = document.createElement('li');
  li.className = 'list-group-item';
  li.innerHTML = `<a href="${r.url}" target="_blank">${r.title}</a>`;
  document.getElementById('recList').appendChild(li);
});
